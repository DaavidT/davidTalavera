---
import BaseLayout from '@/layouts/BaseLayout.astro';
import {
  ProjectScreen,
  getTranslatedProjects,
  getTranslatedProjectBySlug,
} from '@/features/projects';
import { defaultLanguage, ui, type LanguageCode } from '@/i18n/ui';

export async function getStaticPaths() {
  const projects = await getTranslatedProjects(defaultLanguage);
  return projects.map((project) => ({
      params: { slug: project.slug },
    }));
}
const lang = (Astro.currentLocale as LanguageCode | undefined) ?? defaultLanguage;
const slug = Astro.params.slug ?? '';
const project = await getTranslatedProjectBySlug(slug, lang);

const t = ui[lang];

if (!project) {
  const base = lang === defaultLanguage ? '' : `/${lang}`;
  return Astro.redirect(`${base}/404`);
}

const pageTitle = `${project.title} | ${t.site.title}`;
const pageDescription = project.detailedDescription ?? project.description;
---

<BaseLayout pageTitle={pageTitle} pageDescription={pageDescription}>
  <ProjectScreen project={project} t={t} lang={lang} />
</BaseLayout>
